{% extends 'cvs/base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <div class="box">
        <h2>ğŸ“ Ná»™p CV cá»§a báº¡n</h2>
        <p style="color: #666; margin-bottom: 20px;">Táº£i lÃªn CV cá»§a báº¡n Ä‘á»ƒ há»‡ thá»‘ng AI phÃ¢n tÃ­ch vÃ  gá»£i Ã½ viá»‡c lÃ m phÃ¹
            há»£p nháº¥t.</p>

        <form method="post" enctype="multipart/form-data" onsubmit="showLoading()">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-block" style="margin-top: 20px;">ğŸš€ PhÃ¢n tÃ­ch ngay</button>
        </form>

        {% if analyzed_data %}
        <hr>
        <h3>ğŸ“Š Káº¿t quáº£ phÃ¢n tÃ­ch CV</h3>
        <p><strong>Há» tÃªn:</strong> {{ analyzed_data.full_name|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</p>
        <p><strong>Email:</strong> {{ analyzed_data.email|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</p>
        <p><strong>Äiá»‡n thoáº¡i:</strong> {{ analyzed_data.phone|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</p>
        <p><strong>Ká»¹ nÄƒng:</strong> {{ analyzed_data.skills|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</p>
        <p><strong>Há»c váº¥n:</strong></p>
        <pre>{{ analyzed_data.education|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</pre>
        <p><strong>Kinh nghiá»‡m:</strong></p>
        <pre>{{ analyzed_data.experience|default:"(KhÃ´ng xÃ¡c Ä‘á»‹nh)" }}</pre>
        {% endif %}

        {% if score %}
        <div
            style="background: #f8fff9; padding: 20px; border-radius: 8px; margin-top: 30px; border: 1px solid #c3e6cb;">
            <h3 style="margin-top:0; color: #155724; text-align: center;">ğŸ“Š Äiá»ƒm Ä‘Ã¡nh giÃ¡: {{ score.total }}/100</h3>
            <hr style="border: 0; border-top: 1px solid #c3e6cb; margin: 15px 0;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div>â€¢ LiÃªn há»‡: <b>{{ score.breakdown.contact }}</b>/20</div>
                <div>â€¢ Ká»¹ nÄƒng: <b>{{ score.breakdown.skills }}</b>/25</div>
                <div>â€¢ Há»c váº¥n: <b>{{ score.breakdown.education }}</b>/15</div>
                <div>â€¢ Kinh nghiá»‡m: <b>{{ score.breakdown.experience }}</b>/25</div>
                <div>â€¢ Bá»‘ cá»¥c: <b>{{ score.breakdown.structure }}</b>/15</div>
            </div>
        </div>
        {% endif %}
    </div>

    {% if match_results %}
    <div class="box">
        <h2>ğŸ¯ Viá»‡c lÃ m phÃ¹ há»£p nháº¥t</h2>
        <ul>
            {% for item in match_results %}
            <li>
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div>
                        <strong style="font-size: 1.1rem;">{{ item.job.title }}</strong>
                        <div style="font-size: 14px; color: #666; margin-top: 4px;">ğŸ¢ {{ item.job.company }}</div>
                    </div>
                    <span class="badge" style="background: #ffeeba; color: #856404; font-size: 14px;">ğŸ”¥ {{ item.score}}% phÃ¹ há»£p</span>
                </div>

                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <a href="{{ item.job.url }}" target="_blank" rel="noopener noreferrer" class="btn"
                        style="background: #6c757d; font-size: 14px; padding: 6px 12px;">Xem chi tiáº¿t</a>
                    {% if current_cv %}
                    <form action="{% url 'apply_job' current_cv.id item.job.id %}" method="post" style="margin:0;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-green">ğŸ“§ á»¨ng tuyá»ƒn ngay</button>
                    </form>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}
